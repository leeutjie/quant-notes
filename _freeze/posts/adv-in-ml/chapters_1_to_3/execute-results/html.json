{
  "hash": "7987c9837d2fee93b468abd9903fcd64",
  "result": {
    "markdown": "---\ntitle: \"Practical Notes: Advances in Financtial Machine Learning Chapters 1-3 - Work in Progress\"\nauthor: \"Louis Becker\"\ndate: \"2023-03-08\"\ncategories: [machine learning, code, python, finance, quant]\nimage: \"image.jpg\"\n---\n\n## Introduction\n\nThis is the first of a series of blog posts summarising chapters from Advances in [Financial Machine Learning](https://www.wiley.com/en-us/Advances+in+Financial+Machine+Learning-p-9781119482086) by [Marcos Lopez de Prado](https://twitter.com/lopezdeprado). The only aim here is to condense knowledge and insights into almost cheatsheet-like nuggets that I can reference back to when I need them. I do not offer context or expalanations beyond what makes sense to me. I shamelessly and liberally borrow his notation and texts for coherency. \n\n## Sampling Features\n\nIt is useful to think about sampling strategies when applying machine-learning algorithms in finance for two reasons: First, several ML algorithms do not scale well with sample size (e.g., SVMs). Second, ML algorithms achieve highest accuracy when they attempt to learn from relevant examples. We will try to look at some palatable ways of sampling bars to produce a features matrix with relevant training examples.\n\n### The CUSUM Filter\n\nThe CUSUM filter is a quality-control method, designed to detect a shift in the mean value of a measured quantity away from a target value. If we consider a set of independently and identically distributed ($iid$) observations $\\{y_t\\}_{t=1,...,T}$, we can define the cumulative sums as\n\n$$S_t = max\\{0, S_{t-1} + y_t - E_{t-1}[y_t]\\}$$\n\nwith boundary condition $S_0 = 0$. This procedure would recommend an action at the first $t$ satisfying $S_t \\geq h$, for some some threshold $h$ (referred to as the filter size). It implies that $S_t = 0$ whenever $y_t \\leq E_{t-1}[y_t] - S_{t-1}$. This zero floor means that we will skip some downward deviations that otherwise would make $S_t$ negative. The reason is, the filter is set up to identify a sequence of upside divergences from any reset level zero. \n\nThe threshold is activated when \n\n$$S_t \\geq h \\iff \\exists \\tau \\in [1,t] | \\sum$$\n\n\nWe will sample a bar $t$ if and only if $S_t \\geq h$, at which point $S_t$ is reset. Let's examine an implementation where $E_{t-1}[y_t] = t_{t-1}$\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport datetime\nimport Labels\nimport importlib\nimportlib.reload(Labels)\nfrom sklearn.model_selection import train_test_split\n```\n:::\n\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>datestamp</th>\n      <th>entity</th>\n      <th>name</th>\n      <th>item</th>\n      <th>source_name</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2003-01-02</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>909.030029</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2003-01-03</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>908.590027</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2003-01-06</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>929.010010</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2003-01-07</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>922.929993</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2003-01-08</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>909.929993</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>499</th>\n      <td>2004-12-27</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>1204.920044</td>\n    </tr>\n    <tr>\n      <th>500</th>\n      <td>2004-12-28</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>1213.540039</td>\n    </tr>\n    <tr>\n      <th>501</th>\n      <td>2004-12-29</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>1213.449951</td>\n    </tr>\n    <tr>\n      <th>502</th>\n      <td>2004-12-30</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>1213.550049</td>\n    </tr>\n    <tr>\n      <th>503</th>\n      <td>2004-12-31</td>\n      <td>SPX Index</td>\n      <td>S&amp;P 500 INDEX</td>\n      <td>PX_LAST</td>\n      <td>BB</td>\n      <td>1211.920044</td>\n    </tr>\n  </tbody>\n</table>\n<p>504 rows Ã— 6 columns</p>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "chapters_1_to_3_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}